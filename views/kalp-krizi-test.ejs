<!DOCTYPE html>
<html lang="en">

<head>
  <title>Sağlık Portalı</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Custom CSS -->
  <link rel="stylesheet" href="/stylee.css">
  <link flex href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
  <script src="/scriptNavbar.js" defer></script>
  <link rel="stylesheet" href="/navbar.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <style>
    body {
      background-position: center;
      background-color: rgba(255, 255, 255, 0.5);
    }

    .navbar {
      margin-bottom: 0;
      border-radius: 0;
    }

    footer {
      background-color: #555;
      color: white;
      padding: 15px;
      margin-bottom: 0;
      padding-bottom: 0;
    }

    @media screen and (min-width: 800px) {
      body {
        margin-left: 88px;
        margin-right: 20px;
      }
    }

    @media screen and (max-width: 800px) {
      body {
        margin-top: 15px;
        margin-right: 20px;
        margin-left: 20px;
      }

      .sidenav {
        height: auto;
        padding: 15px;
      }

      .row.content {
        height: auto;
      }
    }

    * {
      margin: 0px;
      padding: 0px;
      box-sizing: border-box;
    }

    .range-value {
      display: inline-block;
      width: 30px;
      text-align: center;
      margin-left: 10px;
    }
  </style>
</head>

<body>
  <nav class="navbar flex phoneNavbar">
    <div class="container-fluid">
    </div>
  </nav>

  <div class="container-fluid">
    <div class="row" style="z-index: 0;">
      <%- include('partial/sidebar') %>

      <div class="container mt-5">
        <div class="row justify-content-center align-items-center">
          <div class="col-md-5 col-sm-5 col-xs-2">
            <div class="container mt-5">
              <h3 class="text-center">Kalp Krizi Testi</h3>
              <form id="heart-attack-test-form">
                <div class="mb-3">
                  <label for="age" class="form-label">Yaşınız:</label>
                  <input type="range" class="form-range" name="age" id="age" min="0" max="100" value="50">
                  <span class="range-value">50</span>
                </div>

                <div class="mb-3">
                  <label for="gender" class="form-label">Cinsiyet Seçimi:</label>
                  <input type="range" class="form-range" name="gender" id="gender" min="1" max="2" value="1">
                  <span id="genderLabel" class="range-value">Erkek</span>
                </div>

                <div class="mb-3">
                  <label for="diabetes" class="form-label">Diabetiniz var mı?</label>
                  <input type="range" class="form-range" name="diabetes" id="diabetes" min="0" max="1" value="0">
                  <span class="range-value">0</span>
                </div>

                <div class="mb-3">
                  <label for="familyHistory" class="form-label">Aile geçmişinde kalp krizi var mı?</label>
                  <input type="range" class="form-range" name="familyHistory" id="familyHistory" min="0" max="1" value="0">
                  <span class="range-value">0</span>
                </div>

                <div class="mb-3">
                  <label for="smoking" class="form-label">Sigara kullanımı:</label>
                  <input type="range" class="form-range" name="smoking" id="smoking" min="0" max="1" value="0">
                  <span class="range-value">0</span>
                </div>

                <div class="mb-3">
                  <label for="obesity" class="form-label">Obezite düzeyi:</label>
                  <input type="range" class="form-range" name="obesity" id="obesity" min="0" max="1" value="0">
                  <span class="range-value">0</span>
                </div>

                <div class="mb-3">
                  <label for="alcoholConsumption" class="form-label">Alkol tüketimi:</label>
                  <input type="range" class="form-range" name="alcoholConsumption" id="alcoholConsumption" min="0" max="1" value="0">
                  <span class="range-value">0</span>
                </div>

                <div class="mb-3">
                  <label for="exerciseHoursPerWeek" class="form-label">Haftalık egzersiz saati:</label>
                  <input type="range" class="form-range" name="exerciseHoursPerWeek" id="exerciseHoursPerWeek" min="0" max="7" value="0">
                  <span class="range-value">0</span>
                </div>

                <div class="mb-3">
                  <label for="diet" class="form-label">Beslenme düzeni:</label>
                  <input type="range" class="form-range" name="diet" id="diet" min="0" max="1" value="0">
                  <span class="range-value">0</span>
                </div>

                <div class="mb-3">
                  <label for="previousHeartProblems" class="form-label">Önceki kalp problemleri:</label>
                  <input type="range" class="form-range" name="previousHeartProblems" id="previousHeartProblems" min="0" max="1" value="0">
                  <span class="range-value">0</span>
                </div>

                <div class="mb-3">
                  <label for="medicationUse" class="form-label">İlaç kullanımı:</label>
                  <input type="range" class="form-range" name="medicationUse" id="medicationUse" min="0" max="1" value="0">
                  <span class="range-value">0</span>
                </div>

                <div class="mb-3">
                  <label for="stressLevel" class="form-label">Stres düzeyi:</label>
                  <input type="range" class="form-range" name="stressLevel" id="stressLevel" min="0" max="7" value="0">
                  <span class="range-value">0</span>
                </div>

                <div class="mb-3">
                  <label for="sedentaryHoursPerDay" class="form-label">Günlük hareketsiz saat:</label>
                  <input type="range" class="form-range" name="sedentaryHoursPerDay" id="sedentaryHoursPerDay" min="0" max="24" value="0">
                  <span class="range-value">0</span>
                </div>

                <div class="mb-3">
                  <label for="bmi" class="form-label">Beden kitle indeksi (BMI):</label>
                  <input type="range" class="form-range" name="bmi" id="bmi" min="0" max="50" value="0">
                  <span class="range-value">0</span>
                </div>

                <div class="mb-3">
                  <label for="physicalActivityDaysPerWeek" class="form-label">Haftalık fiziksel aktivite gün sayısı:</label>
                  <input type="range" class="form-range" name="physicalActivityDaysPerWeek" id="physicalActivityDaysPerWeek" min="0" max="7" value="0">
                  <span class="range-value">0</span>
                </div>

                <div class="mb-3">
                  <label for="sleepHoursPerDay" class="form-label">Günlük uyku saati:</label>
                  <input type="range" class="form-range" name="sleepHoursPerDay" id="sleepHoursPerDay" min="0" max="24" value="0">
                  <span class="range-value">0</span>
                </div>

                <button type="submit" class="btn btn-primary">Gönder</button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Bootstrap Modal -->
      <div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="resultModalLabel">Test Sonucu</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="alert" id="resultAlert" role="alert">
                <h2 id="resultText"></h2>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
              <button type="button" class="btn btn-primary" id="saveResultsButton">Kaydet</button>
            </div>
          </div>
        </div>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
      <script>
        document.querySelectorAll('.form-range').forEach(function(input) {
          input.addEventListener('input', function() {
            this.nextElementSibling.textContent = this.value;
          });
        });

        document.getElementById('gender').addEventListener('input', function() {
          var gender = (this.value === '1') ? 'Erkek' : 'Kadın';
          document.getElementById('genderLabel').textContent = gender;
        });

        const form = document.getElementById('heart-attack-test-form');
        form.addEventListener('submit', async function(event) {
          event.preventDefault();
          
          const formData = new FormData(form);
          const data = Object.fromEntries(formData.entries());

          try {
            const response = await fetch('/kalp-krizi-test', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(data)
            });
            const result = await response.json();

            let resultText = '';
            let alertClass = '';
            if (result.output === 0) {
              resultText = 'Düşük';
              alertClass = 'alert-light';
            } else if (result.output === 1) {
              resultText = 'Yüksek';
              alertClass = 'alert-danger';
            }
            document.getElementById('resultText').textContent = resultText;
            document.getElementById('resultAlert').className = `alert ${alertClass}`;
            const resultModal = new bootstrap.Modal(document.getElementById('resultModal'));
            resultModal.show();
          } catch (error) {
            console.error('Error:', error);
          }
        });

        document.getElementById('saveResultsButton').addEventListener('click', async function() {
          const formData = new FormData(form);
          const data = Object.fromEntries(formData.entries());
          data.saveResults = 'on';

          try {
            const response = await fetch('/kalp-krizi-test', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify(data)
            });

            const result = await response.json();
            alert('Sonuçlar kaydedildi!');
            const resultModal = bootstrap.Modal.getInstance(document.getElementById('resultModal'));
            resultModal.hide();
          } catch (error) {
            console.error('Error:', error);
          }
        });
      </script>
</body>

</html>
